<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Explosion.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">01_Assignment</a> &gt; <a href="index.source.html" class="el_package">Tanks</a> &gt; <span class="el_source">Explosion.java</span></div><h1>Explosion.java</h1><pre class="source lang-java linenums">package Tanks;

import processing.core.PApplet;

public class Explosion {
    /**
     * make of the explosion
     */
    private String maker;
    /**
     * explosion duration
     */
<span class="fc" id="L13">    private float duration = 0.2f * App.getFPS(); // in frame</span>
    /**
     * maximum damage of the explosion
     */
<span class="fc" id="L17">    private int damageMax = 60;</span>
    /**
     * initial x position of the explosion
     */
    private int xPos;
    /**
     * initial y position of the explosion
     */
    private float yPos;
    /**
     * The radius of the red explosion
     */
<span class="fc" id="L29">    private float redRadius = 0;</span>
    /**
     * The radius of the orange explosion
     */
<span class="fc" id="L33">    private float orangeRadius = 0;</span>
    /**
     * The radius of the yellow explosion
     */
<span class="fc" id="L37">    private float yellowRadius = 0;</span>
    /**
     * Radius where explosion make damage
     */
    private int damageRadius;
    /**
     * Maximum radius of the red explosion
     */
    private float redRadiusMax;
    /**
     * Maximum radius of the orange explosion
     */
    private float orangeRadiusMax;
    /**
     * Maximum radius of the yellow explosion
     */
    private float yellowRadiusMax;
    /**
     * Frame counter
     */
<span class="fc" id="L57">    private int frameFromStart = 0;</span>
    /**
     * Current state if explosion is exploding
     */
    private boolean isExploding;
    /**
     * Current state if explosion is exploded
     */
    private boolean isExploded;
    /**
     * Current state if explosion is collapsed
     */
    private boolean isCollapsed;
    /**
     * Current state if explosion has deal damage
     */
    private boolean isDealDamaged;

    /**
     * Create new explosion
     * 
     * @param xPos         initial x position
     * @param yPos         initial y position
     * @param damageRadius radius where damage is dealed
     * @param maker        the maker of the explosion
     */
<span class="fc" id="L83">    public Explosion(int xPos, float yPos, int damageRadius, String maker) {</span>
<span class="fc" id="L84">        this.maker = maker;</span>
<span class="fc" id="L85">        this.xPos = xPos;</span>
<span class="fc" id="L86">        this.yPos = yPos;</span>
<span class="fc" id="L87">        this.isExploding = true;</span>
<span class="fc" id="L88">        this.isExploded = false;</span>
<span class="fc" id="L89">        this.isCollapsed = false;</span>
<span class="fc" id="L90">        this.isDealDamaged = false;</span>
<span class="fc" id="L91">        this.damageRadius = damageRadius;</span>
<span class="fc" id="L92">        this.redRadiusMax = damageRadius;</span>
<span class="fc" id="L93">        this.orangeRadiusMax = damageRadius * 0.5f;</span>
<span class="fc" id="L94">        this.yellowRadiusMax = damageRadius * 0.2f;</span>

<span class="fc" id="L96">    }</span>

    /**
     * All the actions explosion do at every tick
     */
    public void tick() {
<span class="pc bpc" id="L102" title="2 of 4 branches missed.">        if (isExploding &amp;&amp; frameFromStart &lt;= duration) {</span>
<span class="fc" id="L103">            redRadius += redRadiusMax / duration;</span>
<span class="fc" id="L104">            orangeRadius += orangeRadiusMax / duration;</span>
<span class="fc" id="L105">            yellowRadius += yellowRadiusMax / duration;</span>
        } else {
<span class="nc" id="L107">            isExploding = false;</span>
<span class="nc" id="L108">            isExploded = true;</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">            if (!isCollapsed) {</span>
<span class="nc" id="L111">                executeCollapse();</span>
            }
        }
<span class="fc" id="L114">        frameFromStart++;</span>
<span class="fc" id="L115">    }</span>

    /**
     * Get the damage deal status
     * 
     * @return whether the explosion has deal damage or not
     */
    public boolean getDealDamagedStatus() {
<span class="fc" id="L123">        return isDealDamaged;</span>
    }

    /**
     * Set the damage deal status
     */
    public void setDealDamagedStatus() {
<span class="fc" id="L130">        isDealDamaged = true;</span>
<span class="fc" id="L131">    }</span>

    /**
     * Set the exploded status
     */
    public void setExplodedStatus() {
<span class="fc" id="L137">        isExploded = true;</span>
<span class="fc" id="L138">    }</span>

    /**
     * Set the exploding status
     */
    public void setExplodingStatus() {
<span class="fc" id="L144">        isExploding = true;</span>
<span class="fc" id="L145">    }</span>

    /**
     * Get the exploded status
     * 
     * @return exploded status
     */
    public boolean getExplodedStatus() {
<span class="fc" id="L153">        return isExploded;</span>
    }

    /**
     * Get the exploding staus
     * 
     * @return exploding status
     */
    public boolean getExplodingStatus() {
<span class="fc" id="L162">        return isExploding;</span>
    }

    /**
     * Explosion deal damage
     * 
     * @param tankXPos tank x position
     * @param tankYPos tank y position
     * @return calculated damage on tank
     */
    public float dealDamage(int tankXPos, float tankYPos) {
<span class="fc" id="L173">        float xDifSquare = (float) Math.pow(Math.abs(xPos - tankXPos), 2);</span>
<span class="fc" id="L174">        float yDifSquare = (float) Math.pow(Math.abs(yPos - tankYPos), 2);</span>
<span class="fc" id="L175">        float radius = (float) Math.sqrt(xDifSquare + yDifSquare);</span>
<span class="fc" id="L176">        return calDamage(radius);</span>
    }

    /**
     * Calculate damage based on radius
     * 
     * @param radius radius
     * @return damage
     */
    public float calDamage(float radius) {
<span class="fc bfc" id="L186" title="All 2 branches covered.">        if (radius &gt; damageRadius) {</span>
<span class="fc" id="L187">            return 0;</span>
        } else {
<span class="fc" id="L189">            float damage = (damageRadius - radius) / damageRadius * damageMax;</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">            if (damage &gt;= damageMax) {</span>
<span class="nc" id="L191">                damage = damageMax;</span>
            }
<span class="fc" id="L193">            return damage;</span>
        }
    }

    /**
     * Calculate the collapse height of terrain
     * 
     * @param anyxPos x position
     * @return chord length
     */
    public float calCollapseHeight(int anyxPos) {
<span class="fc" id="L204">        int xPosDif = Math.abs(xPos - anyxPos);</span>
<span class="fc" id="L205">        float chord = 2 * (float) Math.sqrt(Math.pow(damageRadius, 2) - Math.pow(xPosDif, 2));</span>
<span class="fc" id="L206">        return chord;</span>
    }

    /**
     * Get the maker of explosion
     * 
     * @return make
     */
    public String getMaker() {
<span class="fc" id="L215">        return maker;</span>
    }

    /**
     * Execute the collpase of terrain
     */
    public void executeCollapse() {
<span class="fc" id="L222">        int startxPos = xPos - damageRadius;</span>
<span class="fc" id="L223">        int endxPos = xPos + damageRadius;</span>
<span class="fc" id="L224">        float startyPos = yPos - damageRadius;</span>
<span class="fc" id="L225">        float endyPos = yPos + damageRadius;</span>

<span class="fc bfc" id="L227" title="All 2 branches covered.">        for (int x = startxPos; x &lt;= endxPos; x++) {</span>
<span class="fc" id="L228">            float terrainHeight = App.getTerrainHeight(x, &quot;pixel&quot;);</span>
            float collapseHeight;

<span class="pc bpc" id="L231" title="3 of 4 branches missed.">            if (terrainHeight &lt;= startyPos &amp;&amp; terrainHeight &lt;= endyPos) {</span>
<span class="nc" id="L232">                collapseHeight = calCollapseHeight(x);</span>
<span class="pc bpc" id="L233" title="1 of 4 branches missed.">            } else if (terrainHeight &gt; startyPos &amp;&amp; terrainHeight &gt; endyPos) {</span>
<span class="fc" id="L234">                collapseHeight = 0;</span>
            } else {
<span class="fc" id="L236">                float collapsePortion = Math.abs(terrainHeight - endyPos) / (2 * damageRadius);</span>
<span class="fc" id="L237">                collapseHeight = calCollapseHeight(x) * collapsePortion;</span>
            }

<span class="fc" id="L240">            float remainingHeight = terrainHeight + collapseHeight;</span>
<span class="fc" id="L241">            float remainingHeightRaw = remainingHeight / App.getCell(&quot;height&quot;);</span>
<span class="fc" id="L242">            App.setTerrainHeight(x, remainingHeightRaw);</span>
        }

<span class="fc" id="L245">        isCollapsed = true;</span>
<span class="fc" id="L246">    }</span>

    /**
     * Get the state whether explosion is completed
     * 
     * @return finish explosion status
     */
    public boolean finishExplosion() {
<span class="fc" id="L254">        return this.isExploded;</span>
    }

    /**
     * Draw the explosion
     * 
     * @param app app
     */
    public void draw(PApplet app) {

        // Red circle
<span class="fc" id="L265">        app.noStroke();</span>
<span class="fc" id="L266">        app.fill(255, 0, 0);</span>
<span class="fc" id="L267">        app.ellipse(xPos, yPos, 2 * redRadius, 2 * redRadius);</span>

        // Orange circle
<span class="fc" id="L270">        app.noStroke();</span>
<span class="fc" id="L271">        app.fill(255, 165, 0);</span>
<span class="fc" id="L272">        app.ellipse(xPos, yPos, 2 * orangeRadius, 2 * orangeRadius);</span>

        // Yellow circle
<span class="fc" id="L275">        app.noStroke();</span>
<span class="fc" id="L276">        app.fill(255, 255, 0);</span>
<span class="fc" id="L277">        app.ellipse(xPos, yPos, 2 * yellowRadius, 2 * yellowRadius);</span>
<span class="fc" id="L278">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>