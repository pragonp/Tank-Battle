<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>App.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">01_Assignment</a> &gt; <a href="index.source.html" class="el_package">Tanks</a> &gt; <span class="el_source">App.java</span></div><h1>App.java</h1><pre class="source lang-java linenums">package Tanks;

import java.util.*;
import processing.core.PApplet;
import processing.core.PFont;
import processing.core.PImage;
import processing.data.JSONArray;
import processing.data.JSONObject;
import processing.event.KeyEvent;

public class App extends PApplet {
    /*
     * The width of the display window
     */
<span class="fc" id="L15">    public static int WIDTH = 864;</span>

    /*
     * The height of the display window
     */
<span class="fc" id="L20">    public static int HEIGHT = 640;</span>

    /**
     * Default font
     */
    public static final String defaultFont = &quot;Calibri Bold&quot;;
    /**
     * Default normal font size
     */
    public static final int defaultFontSize = 24;
    /**
     * Default small font size
     */
    public static final int defaultSmallFontSize = 20;
    /**
     * cell size in pixel
     */
    public static final int CELLSIZE = 32;
    /**
     * cell width in pixel
     */
    public static final int CELLWIDTH = 32;
    /**
     * cell height in pixel
     */
    public static final int CELLHEIGHT = 32;

    /**
     * Board width
     */
<span class="fc" id="L50">    public static final int BOARD_WIDTH = WIDTH / CELLSIZE;</span>
    /**
     * Board Heigth
     */
    public static final int BOARD_HEIGHT = 20;
    /**
     * frame per second
     */
    public static final int FPS = 30;
    /**
     * time that arrow is above the current playing tank
     */
    public static final int arrowTimeSec = 2;

    /**
     * Counter for arrow time
     */
<span class="fc" id="L67">    public static int arrowFrameCounter = 0;</span>
    /**
     * The config file path
     */
    public String configPath;
    /**
     * random number
     */
<span class="fc" id="L75">    public static Random random = new Random();</span>

    /**
     * Array for Projectile
     */
    public static ArrayList&lt;Projectile&gt; projectiles;
    /**
     * Array for Explosion
     */
    public static ArrayList&lt;Explosion&gt; explosions;
    /**
     * Array for Level
     */
    public static ArrayList&lt;Level&gt; levels;
    /**
     * Array for Color
     */
    public static ArrayList&lt;Color&gt; colors;
    /**
     * Array for Player
     */
    public static ArrayList&lt;Player&gt; players;
    /**
     * Array for player rank based on directly from text file
     */
    public static ArrayList&lt;String&gt; rank;
    /**
     * Array for smoothed terrain
     */
    public static ArrayList&lt;Float&gt; smoothTerrain;
    /**
     * Array for Tank
     */
    public static ArrayList&lt;Tank&gt; tanks;
    /**
     * Array for Tree
     */
    public static ArrayList&lt;Tree&gt; trees;
    /**
     * Array for sorted tank based on correct turn
     */
    public static ArrayList&lt;Tank&gt; sortedTanks;
    /**
     * Array for sorted player with correct turn
     */
    public static ArrayList&lt;Player&gt; sortedPlayers;
    /**
     * Wind object
     */
    public static Wind wind;
    /**
     * Current player
     */
    public static int currentPlayer;
    /**
     * Number of projectile on the map
     */
<span class="fc" id="L132">    public static int projectileFire = 0;</span>
    /**
     * Limit number of projectile per turn
     */
<span class="fc" id="L136">    public static int projectileTurnLimit = 1;</span>
    /**
     * State of the large projectile activation
     */
    public static boolean largeProjectileActivated;
    /**
     * game count
     */
    public static int gameCount;
    /**
     * total game
     */
    public static int gameTotal;
    /**
     * number of turn played
     */
    public static int turnPlayed;
    /**
     * round winner drawing counter
     */
    public static int hasRoundWinnerFrame;
    /**
     * state for trigger next round
     */
    public static boolean nextRoundTriggered;
    /**
     * The red RGB color code of foreground
     */
    public static int redRGBForeground;
    /**
     * The green RGB color code of foreground
     */
    public static int greenRGBForeground;
    /**
     * The blue RGB color code of foreground
     */
    public static int blueRGBForeground;
    /**
     * State of end game
     */
    public static boolean endGame;
    /**
     * End game frame counter
     */
    public static int endGameFrame;
    /**
     * Text to indicate current player turn
     */
    public PFont playerTurnText;
    /**
     * Text to indicate current tank fuel
     */
    public PFont fuelText;
    /**
     * Text to indicate the number of parachute
     */
    public PFont parachuteText;
    /**
     * Text to indicate health
     */
    public PFont healthText;
    /**
     * Text to indicate power
     */
    public PFont powerText;
    /**
     * Text to indicate wind speed
     */
    public PFont windText;
    /**
     * Text to indicate player score
     */
    public PFont playerScoreText;
    /**
     * Background image
     */
    public PImage background;
    /**
     * Fuel image
     */
    public PImage fuel;
    /**
     * Parachute image
     */
    public PImage parachute;
    /**
     * Wind blowing left image
     */
    public PImage windLeft;
    /**
     * Wind blowing right image
     */
    public PImage windRight;
    /**
     * Tree image path
     */
    public static String treeFilePath;

    /**
     * Main function executing the app
     * 
     * @param args command line argument
     */
    public static void main(String[] args) {
<span class="nc" id="L240">        PApplet.main(&quot;Tanks.App&quot;);</span>
<span class="nc" id="L241">    }</span>

    /**
     * Call on the config path
     */
<span class="fc" id="L246">    public App() {</span>
<span class="fc" id="L247">        this.configPath = &quot;config.json&quot;;</span>
<span class="fc" id="L248">    }</span>

    /**
     * Set the width and height of display window
     */
    @Override
    public void settings() {
<span class="fc" id="L255">        size(WIDTH, HEIGHT);</span>
<span class="fc" id="L256">    }</span>

    /**
     * Setup method calls on many methods that require to run at the beginning once
     */
    @Override
    public void setup() {
<span class="fc" id="L263">        players = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L264">        levels = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L265">        colors = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L266">        gameCount = 0;</span>
<span class="fc" id="L267">        endGameFrame = 0;</span>
<span class="fc" id="L268">        frameRate(FPS);</span>
<span class="fc" id="L269">        createFont();</span>
<span class="fc" id="L270">        processJSON();</span>
<span class="fc" id="L271">        gameTotal = levels.size();</span>
<span class="fc" id="L272">        prepareObject();</span>
<span class="fc" id="L273">    }</span>

    /**
     * Draw objects, HUD, scoreboard and control the sequence of what
     * user will see.
     */
    @Override
    public void draw() {
<span class="fc bfc" id="L281" title="All 2 branches covered.">        if (endGame) {</span>
<span class="fc" id="L282">            drawEndGame();</span>
<span class="fc" id="L283">            return;</span>
        }

<span class="fc bfc" id="L286" title="All 2 branches covered.">        if (nextRoundTriggered) {</span>
<span class="fc" id="L287">            hasRoundWinnerFrame++;</span>
        }

<span class="fc" id="L290">        executeLogic();</span>
<span class="fc" id="L291">        drawBlank();</span>
<span class="fc" id="L292">        drawObjects();</span>
<span class="fc" id="L293">        drawHUD();</span>

<span class="pc bpc" id="L295" title="1 of 2 branches missed.">        if (!players.isEmpty()) {</span>
<span class="fc" id="L296">            drawScoreBoard();</span>
        }
<span class="fc" id="L298">    }</span>

    /**
     * Receive key pressed signal from the keyboard
     * and then take action accordingly.
     * 
     * @param event the key user pressed
     */
    @Override
    public void keyPressed(KeyEvent event) {
<span class="fc" id="L308">        Tank currentTank = tanks.get(currentPlayer);</span>
<span class="fc" id="L309">        String currentTankName = currentTank.getTankName();</span>

<span class="fc bfc" id="L311" title="All 4 branches covered.">        if (currentTank.isAlive() &amp;&amp; projectileFire &lt; projectileTurnLimit) {</span>
<span class="fc bfc" id="L312" title="All 2 branches covered.">            if (event.getKeyCode() == LEFT) {</span>
<span class="fc" id="L313">                currentTank.move(&quot;left&quot;);</span>
<span class="fc bfc" id="L314" title="All 2 branches covered.">            } else if (event.getKeyCode() == RIGHT) {</span>
<span class="fc" id="L315">                currentTank.move(&quot;right&quot;);</span>
<span class="fc bfc" id="L316" title="All 2 branches covered.">            } else if (event.getKeyCode() == UP) {</span>
<span class="fc" id="L317">                currentTank.rotateTurret(-1);</span>
<span class="fc bfc" id="L318" title="All 2 branches covered.">            } else if (event.getKeyCode() == DOWN) {</span>
<span class="fc" id="L319">                currentTank.rotateTurret(1);</span>
<span class="fc bfc" id="L320" title="All 2 branches covered.">            } else if (event.getKeyCode() == 32) { // spacebar</span>
<span class="pc bpc" id="L321" title="1 of 2 branches missed.">                if (hasRoundWinner()) {</span>
<span class="nc" id="L322">                    hasRoundWinnerFrame = FPS;</span>
<span class="nc" id="L323">                    nextRound();</span>
<span class="nc" id="L324">                    return;</span>
                }

<span class="fc" id="L327">                int xPos = currentTank.getxPos();</span>
<span class="fc" id="L328">                float yPos = currentTank.getyPos();</span>
<span class="fc" id="L329">                float turretAngle = currentTank.getTurretAngle();</span>
<span class="fc" id="L330">                float power = currentTank.getPower();</span>
<span class="fc" id="L331">                boolean largeProjectile = currentTank.isLargeProjectile();</span>

<span class="fc" id="L333">                Projectile projectile = new Projectile(xPos, yPos, turretAngle, power, currentTankName,</span>
                        largeProjectile);
<span class="fc" id="L335">                projectiles.add(projectile);</span>
<span class="fc" id="L336">                projectileFire++;</span>

<span class="fc bfc" id="L338" title="All 2 branches covered.">                if (largeProjectile) {</span>
<span class="fc" id="L339">                    currentTank.setLargeProjectile(&quot;off&quot;);</span>
<span class="fc" id="L340">                    largeProjectileActivated = false;</span>
                }

<span class="fc bfc" id="L343" title="All 2 branches covered.">            } else if (event.getKeyCode() == 87) { // w</span>
<span class="fc" id="L344">                currentTank.setPower(&quot;increase&quot;);</span>
<span class="fc bfc" id="L345" title="All 2 branches covered.">            } else if (event.getKeyCode() == 83) { // s</span>
<span class="fc" id="L346">                currentTank.setPower(&quot;decrease&quot;);</span>
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">            } else if (event.getKeyCode() == 82) { // r</span>

                // r is used for both repair tank and restart game
<span class="nc bnc" id="L350" title="All 2 branches missed.">                if (endGame) {</span>
<span class="nc" id="L351">                    restartGame();</span>
                } else {
<span class="nc bnc" id="L353" title="All 2 branches missed.">                    if (currentTank.getHealth() &lt; 100) {</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                        if (players.get(currentPlayer).canUsePowerup(&quot;repair&quot;)) {</span>
<span class="nc" id="L355">                            currentTank.powerUp(&quot;repair&quot;);</span>
                        }
                    }

                }

<span class="fc bfc" id="L361" title="All 2 branches covered.">            } else if (event.getKeyCode() == 70) { // f</span>
<span class="pc bpc" id="L362" title="1 of 2 branches missed.">                if (players.get(currentPlayer).canUsePowerup(&quot;fuel&quot;)) {</span>
<span class="fc" id="L363">                    currentTank.powerUp(&quot;fuel&quot;);</span>
                }
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">            } else if (event.getKeyCode() == 80) { // p</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                if (players.get(currentPlayer).canUsePowerup(&quot;parachute&quot;)) {</span>
<span class="nc" id="L367">                    currentTank.powerUp(&quot;parachute&quot;);</span>
                }
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">            } else if (event.getKeyCode() == 88) { // x</span>
<span class="fc bfc" id="L370" title="All 2 branches covered.">                if (largeProjectileActivated) {</span>
<span class="fc" id="L371">                    return;</span>
                }
<span class="fc bfc" id="L373" title="All 2 branches covered.">                if (players.get(currentPlayer).canUsePowerup(&quot;largeProjectile&quot;)) {</span>
<span class="fc" id="L374">                    currentTank.powerUp(&quot;largeProjectile&quot;);</span>
<span class="fc" id="L375">                    largeProjectileActivated = true;</span>
                }
            }
        }
<span class="fc" id="L379">    }</span>

    /**
     * Load the JSON settings in config.json
     * and then parse the value to the designated variables.
     * These include the file names of layout, background, color, and tree
     * according to the level, and RGB of the player color.
     */
    public void processJSON() {
        JSONObject json;
<span class="fc" id="L389">        json = loadJSONObject(configPath);</span>

<span class="pc bpc" id="L391" title="1 of 2 branches missed.">        if (json != null) {</span>
<span class="fc" id="L392">            JSONArray lvs = json.getJSONArray(&quot;levels&quot;);</span>

<span class="fc bfc" id="L394" title="All 2 branches covered.">            for (int i = 0; i &lt; lvs.size(); i++) {</span>
<span class="fc" id="L395">                JSONObject level = lvs.getJSONObject(i);</span>
<span class="fc" id="L396">                String layout = level.getString(&quot;layout&quot;);</span>
<span class="fc" id="L397">                String background = level.getString(&quot;background&quot;);</span>
<span class="fc" id="L398">                String foregroundColour = level.getString(&quot;foreground-colour&quot;);</span>
<span class="fc" id="L399">                Level levelObj = new Level(layout);</span>

<span class="fc" id="L401">                levels.add(levelObj);</span>
<span class="fc" id="L402">                levelObj.setBackgroundFilePath(background);</span>
<span class="fc" id="L403">                levelObj.setForegroundColor(foregroundColour);</span>

<span class="fc bfc" id="L405" title="All 2 branches covered.">                if (level.hasKey(&quot;trees&quot;)) {</span>
<span class="fc" id="L406">                    String trees = level.getString(&quot;trees&quot;);</span>
<span class="fc" id="L407">                    levelObj.setTreeFilePath(trees);</span>
                }
            }

<span class="fc" id="L411">            rank = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L412">            JSONObject playerColours = json.getJSONObject(&quot;player_colours&quot;);</span>
<span class="fc bfc" id="L413" title="All 2 branches covered.">            for (Object key : playerColours.keys()) {</span>
<span class="fc" id="L414">                String player = (String) key; // Cast the key to String</span>
<span class="fc" id="L415">                String colorCode = playerColours.getString(player);</span>
<span class="fc" id="L416">                rank.add(player);</span>

<span class="fc bfc" id="L418" title="All 2 branches covered.">                if (colorCode.equals(&quot;random&quot;)) {</span>
<span class="fc" id="L419">                    int redRGB = new Random().nextInt(256);</span>
<span class="fc" id="L420">                    int greenRGB = new Random().nextInt(256);</span>
<span class="fc" id="L421">                    int blueRGB = new Random().nextInt(256);</span>
<span class="fc" id="L422">                    colorCode = redRGB + &quot;,&quot; + greenRGB + &quot;,&quot; + blueRGB;</span>
                }

<span class="fc" id="L425">                Color color = new Color(player);</span>
<span class="fc" id="L426">                colors.add(color);</span>
<span class="fc" id="L427">                color.setColorCode(colorCode);</span>
<span class="fc" id="L428">            }</span>
        }
<span class="fc" id="L430">    }</span>

    /**
     * Prepare object for the current level
     */
    public void prepareObject() {
<span class="fc bfc" id="L436" title="All 2 branches covered.">        if (tanks != null) {</span>
<span class="fc" id="L437">            tanks.clear();</span>
        }

<span class="fc bfc" id="L440" title="All 2 branches covered.">        if (trees != null) {</span>
<span class="fc" id="L441">            trees.clear();</span>
        }
<span class="fc bfc" id="L443" title="All 2 branches covered.">        if (explosions != null) {</span>
<span class="fc" id="L444">            explosions.clear();</span>
        }

<span class="fc bfc" id="L447" title="All 2 branches covered.">        if (projectiles != null) {</span>
<span class="fc" id="L448">            projectiles.clear();</span>
        }

<span class="fc" id="L451">        tanks = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L452">        trees = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L453">        explosions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L454">        projectiles = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L456">        loadImage();</span>
<span class="fc" id="L457">        loadTerrain();</span>
<span class="fc" id="L458">        tanks = processTextFile.getTank();</span>
<span class="fc" id="L459">        trees = processTextFile.getTree();</span>
<span class="fc" id="L460">        wind = new Wind();</span>

<span class="fc bfc" id="L462" title="All 2 branches covered.">        for (Tank tank : tanks) {</span>
<span class="fc" id="L463">            tank.setTankColor(colors);</span>
<span class="fc" id="L464">            tank.yPosAdjust();</span>
<span class="fc" id="L465">            tank.startTurret();</span>
<span class="fc" id="L466">        }</span>

<span class="fc bfc" id="L468" title="All 2 branches covered.">        for (Tree tree : trees) {</span>
<span class="fc" id="L469">            tree.yPosAdjust();</span>
<span class="fc" id="L470">        }</span>

<span class="pc bpc" id="L472" title="1 of 2 branches missed.">        if (gameCount == 0) {</span>
<span class="fc" id="L473">            players = processTextFile.getPlayer();</span>
<span class="fc bfc" id="L474" title="All 2 branches covered.">            for (Player player : players) {</span>
<span class="fc" id="L475">                player.setColor(colors);</span>
<span class="fc" id="L476">            }</span>

        } else {
<span class="nc bnc" id="L479" title="All 2 branches missed.">            for (Player player : players) {</span>
<span class="nc" id="L480">                player.resetRoundScore();</span>
<span class="nc" id="L481">            }</span>
        }

<span class="fc" id="L484">        processCorrectTurn();</span>
<span class="fc" id="L485">        redRGBForeground = levels.get(gameCount).getForegroundColor()[0];</span>
<span class="fc" id="L486">        greenRGBForeground = levels.get(gameCount).getForegroundColor()[1];</span>
<span class="fc" id="L487">        blueRGBForeground = levels.get(gameCount).getForegroundColor()[2];</span>

<span class="fc" id="L489">        currentPlayer = 0;</span>
<span class="fc" id="L490">        hasRoundWinnerFrame = 0;</span>
<span class="fc" id="L491">        nextRoundTriggered = false;</span>
<span class="fc" id="L492">    }</span>

    /**
     * Central method to handle logic of
     * projectile, explosion, tank, tree, and
     * the changing of player turn.
     */
    public void executeLogic() {
<span class="fc bfc" id="L500" title="All 2 branches covered.">        if (endGame) {</span>
<span class="fc" id="L501">            return;</span>
        }

<span class="pc bpc" id="L504" title="3 of 4 branches missed.">        if (hasRoundWinner() &amp;&amp; !endGame) {</span>
<span class="nc" id="L505">            nextRound();</span>
        }

<span class="fc" id="L508">        boolean allProjectilesExploded = true;</span>
<span class="fc" id="L509">        boolean allExplosionExploded = true;</span>

<span class="fc bfc" id="L511" title="All 2 branches covered.">        for (Projectile projectile : projectiles) {</span>
<span class="fc" id="L512">            boolean exploded = projectile.getExplodedStatus();</span>
<span class="fc" id="L513">            boolean createdExplosion = projectile.createdExplosion();</span>
<span class="fc" id="L514">            boolean active = projectile.isActive();</span>
<span class="fc" id="L515">            int windSpeed = wind.getCurrentWindSpeed();</span>
<span class="fc" id="L516">            String owner = projectile.getOwner();</span>

<span class="fc" id="L518">            projectile.setWindSpeed(windSpeed);</span>

<span class="pc bpc" id="L520" title="2 of 4 branches missed.">            if (active &amp;&amp; !exploded) {</span>
<span class="fc" id="L521">                allProjectilesExploded = false;</span>
            }

<span class="pc bpc" id="L524" title="2 of 4 branches missed.">            if (exploded &amp; !createdExplosion) {</span>
<span class="nc" id="L525">                int xPosExploded = projectile.getxPosExploded();</span>
<span class="nc" id="L526">                float yPosExploded = projectile.getyPosExploded();</span>
<span class="nc" id="L527">                boolean largeProjectile = projectile.isLargeProjectile();</span>
                int damageRadius;

<span class="nc bnc" id="L530" title="All 2 branches missed.">                if (!largeProjectile) {</span>
<span class="nc" id="L531">                    damageRadius = 30;</span>
                } else {
<span class="nc" id="L533">                    damageRadius = 60;</span>
                }

<span class="nc" id="L536">                Explosion explosion = new Explosion(xPosExploded, yPosExploded, damageRadius, owner);</span>
<span class="nc" id="L537">                explosions.add(explosion);</span>
<span class="nc" id="L538">                projectile.setCreateExplosion();</span>

<span class="nc" id="L540">            } else {</span>
<span class="fc" id="L541">                projectile.tick();</span>
            }
<span class="fc" id="L543">        }</span>

<span class="fc bfc" id="L545" title="All 2 branches covered.">        for (Explosion explosion : explosions) {</span>
<span class="fc" id="L546">            boolean isExploded = explosion.getExplodedStatus();</span>
<span class="fc" id="L547">            boolean isDealDamaged = explosion.getDealDamagedStatus();</span>
<span class="fc" id="L548">            String maker = explosion.getMaker();</span>

<span class="pc bpc" id="L550" title="1 of 2 branches missed.">            if (!isExploded) {</span>
<span class="fc" id="L551">                allExplosionExploded = false;</span>
            }

<span class="pc bpc" id="L554" title="3 of 4 branches missed.">            if (isExploded &amp;&amp; !isDealDamaged) {</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">                for (Tank tank : tanks) {</span>
<span class="nc" id="L556">                    String damagedTankName = tank.getTankName();</span>
<span class="nc" id="L557">                    int tankXPos = tank.getxPos();</span>
<span class="nc" id="L558">                    float tankYPos = tank.getyPos();</span>
<span class="nc" id="L559">                    float damageFreeDrop = tank.getFreeDropDamage();</span>
<span class="nc" id="L560">                    float damageExplosion = explosion.dealDamage(tankXPos, tankYPos);</span>
<span class="nc" id="L561">                    tank.takeDamage(damageExplosion);</span>
<span class="nc" id="L562">                    explosion.setDealDamagedStatus();</span>

<span class="nc bnc" id="L564" title="All 2 branches missed.">                    if (!maker.equals(damagedTankName)) {</span>
<span class="nc" id="L565">                        grantScore(damageExplosion, maker);</span>
<span class="nc" id="L566">                        grantScore(damageFreeDrop, maker);</span>
                    }
<span class="nc" id="L568">                }</span>
            }

<span class="fc" id="L571">            explosion.tick();</span>
<span class="fc" id="L572">        }</span>

<span class="fc bfc" id="L574" title="All 2 branches covered.">        for (Tank tank : tanks) {</span>
<span class="fc" id="L575">            boolean createdExplosion = tank.createdExplosion();</span>
<span class="fc" id="L576">            boolean isAlive = tank.isAlive();</span>
<span class="fc" id="L577">            String owner = tank.getTankName();</span>

<span class="fc bfc" id="L579" title="All 6 branches covered.">            if (!isAlive &amp; !createdExplosion) {</span>
<span class="fc" id="L580">                int xPosExploded = tank.getxPosExploded();</span>
<span class="fc" id="L581">                float yPosExploded = tank.getyPosExploded();</span>
<span class="fc" id="L582">                Explosion explosion = new Explosion(xPosExploded, yPosExploded, 15, owner);</span>
<span class="fc" id="L583">                explosions.add(explosion);</span>
<span class="fc" id="L584">                tank.setCreateExplosion();</span>

<span class="fc" id="L586">            } else {</span>
<span class="fc" id="L587">                tank.tick();</span>
<span class="fc" id="L588">                tank.resetFreeDropDamage();</span>
            }

<span class="fc" id="L591">        }</span>

<span class="fc bfc" id="L593" title="All 2 branches covered.">        for (Tree tree : trees) {</span>
<span class="fc" id="L594">            tree.tick();</span>
<span class="fc" id="L595">        }</span>

<span class="pc bpc" id="L597" title="1 of 8 branches missed.">        if (allProjectilesExploded &amp;&amp; allExplosionExploded &amp;&amp; projectileFire != 0 &amp;&amp; !endGame) {</span>
<span class="fc" id="L598">            nextTurn();</span>
        }
<span class="fc" id="L600">    }</span>

    /**
     * Load terrain to the array
     */
    public void loadTerrain() {
<span class="fc" id="L606">        smoothTerrain = new ArrayList&lt;Float&gt;(896);</span>
<span class="fc" id="L607">        String filepath = levels.get(gameCount).getTextFilePath();</span>
<span class="fc" id="L608">        processTextFile.main(filepath);</span>
<span class="fc" id="L609">        smoothTerrain = processTextFile.getTerrain();</span>
<span class="fc" id="L610">    }</span>

    /**
     * Load all required images
     */
    public void loadImage() {
<span class="fc" id="L616">        String folder = &quot;src/main/resources/Tanks/&quot;;</span>
<span class="fc" id="L617">        background = loadImage(levels.get(gameCount).getBackgroundFilePath());</span>
<span class="fc" id="L618">        treeFilePath = levels.get(gameCount).getTreeFilePath();</span>
<span class="fc" id="L619">        fuel = loadImage(folder + &quot;fuel.png&quot;);</span>
<span class="fc" id="L620">        windLeft = loadImage(folder + &quot;wind-1.png&quot;);</span>
<span class="fc" id="L621">        windRight = loadImage(folder + &quot;wind.png&quot;);</span>
<span class="fc" id="L622">        parachute = loadImage(folder + &quot;parachute.png&quot;);</span>
<span class="fc" id="L623">        background.resize(WIDTH, HEIGHT);</span>
<span class="fc" id="L624">    }</span>

    /**
     * Central method to handle the drawing of
     * terrain, tree, tank, projectile, and explosion.
     */
    public void drawObjects() {
<span class="fc" id="L631">        image(background, 0, 0);</span>

        // this is purely for optimisation.
        // First we Draw from top of terrain to the lowest point terrain
<span class="fc" id="L635">        float lowestHeight = Float.MIN_VALUE;</span>
<span class="fc bfc" id="L636" title="All 2 branches covered.">        for (int i = 0; i &lt; smoothTerrain.size(); i++) {</span>
<span class="fc bfc" id="L637" title="All 2 branches covered.">            if (smoothTerrain.get(i) &gt; lowestHeight) {</span>
<span class="fc" id="L638">                lowestHeight = smoothTerrain.get(i);</span>
            }
        }

<span class="fc bfc" id="L642" title="All 2 branches covered.">        for (int i = 0; i &lt; smoothTerrain.size(); i++) {</span>
<span class="fc" id="L643">            float x = i;</span>
<span class="fc" id="L644">            float y = smoothTerrain.get(i) * CELLHEIGHT;</span>
<span class="fc" id="L645">            float width = 1;</span>
<span class="fc" id="L646">            float firstSectionHeight = Math.abs(lowestHeight * CELLHEIGHT - y);</span>

<span class="fc" id="L648">            fill(redRGBForeground, greenRGBForeground, blueRGBForeground);</span>
<span class="fc" id="L649">            stroke(redRGBForeground, greenRGBForeground, blueRGBForeground);</span>
<span class="fc" id="L650">            strokeWeight(1);</span>
<span class="fc" id="L651">            rect(x, y, width, firstSectionHeight);</span>

        }

        // Second, we draw simple rectangle to cover the rest of terrain
<span class="fc" id="L656">        float secondSectionHeight = lowestHeight * CELLHEIGHT;</span>
<span class="fc" id="L657">        fill(redRGBForeground, greenRGBForeground, blueRGBForeground);</span>
<span class="fc" id="L658">        stroke(redRGBForeground, greenRGBForeground, blueRGBForeground);</span>
<span class="fc" id="L659">        strokeWeight(1);</span>
<span class="fc" id="L660">        rect(0, secondSectionHeight, width, HEIGHT);</span>

<span class="fc bfc" id="L662" title="All 2 branches covered.">        for (Tree tree : trees) {</span>
<span class="fc" id="L663">            tree.draw(this);</span>
<span class="fc" id="L664">        }</span>

<span class="fc bfc" id="L666" title="All 2 branches covered.">        for (Tank tank : tanks) {</span>
<span class="fc" id="L667">            tank.draw(this);</span>
<span class="fc bfc" id="L668" title="All 2 branches covered.">            if (tank == tanks.get(currentPlayer)) {</span>
<span class="fc" id="L669">                drawArrow();</span>
            }
<span class="fc" id="L671">        }</span>

<span class="fc bfc" id="L673" title="All 2 branches covered.">        for (Projectile projectile : projectiles) {</span>
<span class="fc" id="L674">            projectile.draw(this);</span>
<span class="fc" id="L675">        }</span>

<span class="fc bfc" id="L677" title="All 2 branches covered.">        for (Explosion explosion : explosions) {</span>
<span class="pc bpc" id="L678" title="1 of 2 branches missed.">            if (!explosion.finishExplosion()) {</span>
<span class="fc" id="L679">                explosion.draw(this);</span>
            }
<span class="fc" id="L681">        }</span>
<span class="fc" id="L682">    }</span>

    /**
     * Central method to handle the drawing of HUD
     * which include texts to indicate player's turn,
     * remaining gas, power, health and health bar.
     */
    public void drawHUD() {
<span class="fc" id="L690">        int targetYDisplay = 50;</span>
<span class="fc" id="L691">        int targetYDisplaySecond = targetYDisplay + 40;</span>
<span class="fc" id="L692">        int healthBarfullSizeX = 200;</span>

<span class="fc" id="L694">        drawPlayerTurnText(targetYDisplay);</span>
<span class="fc" id="L695">        drawGas(targetYDisplay);</span>
<span class="fc" id="L696">        drawParachute(targetYDisplaySecond);</span>
<span class="fc" id="L697">        drawHealthBar(healthBarfullSizeX, targetYDisplay);</span>
<span class="fc" id="L698">        drawHealthText(targetYDisplay);</span>
<span class="fc" id="L699">        drawPowerBar(healthBarfullSizeX, targetYDisplay);</span>
<span class="fc" id="L700">        drawPowerText(targetYDisplaySecond);</span>
<span class="fc" id="L701">        drawWind(targetYDisplay);</span>
<span class="fc" id="L702">        drawWindText(targetYDisplay);</span>
<span class="fc" id="L703">    }</span>

    /**
     * Show the text to indicate current player's turn
     * 
     * @param targetYDisplay the targeted y location on screen
     */
    public void drawPlayerTurnText(int targetYDisplay) {
<span class="fc" id="L711">        textFont(playerTurnText);</span>
<span class="fc" id="L712">        fill(0);</span>

<span class="pc bpc" id="L714" title="1 of 4 branches missed.">        if (!players.isEmpty() &amp;&amp; currentPlayer &lt; players.size()) {</span>
<span class="fc" id="L715">            String displayText = &quot;Player &quot; + players.get(currentPlayer).getName() + &quot;'s Turn&quot;;</span>
<span class="fc" id="L716">            text(displayText, 30, targetYDisplay);</span>
<span class="fc" id="L717">        } else {</span>
<span class="fc" id="L718">            String displayText = &quot;No Player!&quot;;</span>
<span class="fc" id="L719">            text(displayText, 30, targetYDisplay);</span>
        }
<span class="fc" id="L721">    }</span>

    /**
     * Show the text to indicate current player's remaining gas
     * 
     * @param targetYDisplay the targeted y location on screen
     */
    public void drawGas(int targetYDisplay) {
<span class="fc" id="L729">        int fuelSizeX = 30;</span>
<span class="fc" id="L730">        int fuelSizeY = 30;</span>
<span class="fc" id="L731">        fuel.resize(fuelSizeX, fuelSizeY);</span>
<span class="fc" id="L732">        image(fuel, 200, targetYDisplay - fuelSizeY + 2);</span>
<span class="fc" id="L733">        textFont(fuelText);</span>
<span class="fc" id="L734">        int fuelInt = tanks.get(currentPlayer).getFuel();</span>
<span class="fc" id="L735">        text(fuelInt, 235, targetYDisplay);</span>

<span class="fc" id="L737">    }</span>

    /**
     * Show the remaining parachute
     * 
     * @param targetYDisplaySecond the second targeted y location on screen
     */
    public void drawParachute(int targetYDisplaySecond) {
<span class="fc" id="L745">        int parachuteSizeX = 30;</span>
<span class="fc" id="L746">        int parachuteSizeY = 30;</span>
<span class="fc" id="L747">        parachute.resize(parachuteSizeX, parachuteSizeY);</span>
<span class="fc" id="L748">        image(parachute, 200, targetYDisplaySecond - parachuteSizeY + 2);</span>
<span class="fc" id="L749">        textFont(parachuteText);</span>
<span class="fc" id="L750">        int parachuteInt = tanks.get(currentPlayer).getParachute();</span>
<span class="fc" id="L751">        text(parachuteInt, 235, targetYDisplaySecond);</span>
<span class="fc" id="L752">    }</span>

    /**
     * Draw the health bar
     * 
     * @param healthBarfullSizeX full bar size
     * @param targetYDisplay     the targeted y location on screen
     */
    public void drawHealthBar(int healthBarfullSizeX, int targetYDisplay) {
<span class="fc" id="L761">        float health = tanks.get(currentPlayer).getHealth();</span>
<span class="fc" id="L762">        int redRGB = players.get(currentPlayer).getRGBCode(&quot;red&quot;);</span>
<span class="fc" id="L763">        int greenRGB = players.get(currentPlayer).getRGBCode(&quot;green&quot;);</span>
<span class="fc" id="L764">        int blueRGB = players.get(currentPlayer).getRGBCode(&quot;blue&quot;);</span>
<span class="fc" id="L765">        float barSize = health / 100 * healthBarfullSizeX;</span>
<span class="fc" id="L766">        int barHeight = 25;</span>

<span class="fc" id="L768">        fill(255, 255, 255);</span>
<span class="fc" id="L769">        stroke(0, 0, 0);</span>
<span class="fc" id="L770">        strokeWeight(2);</span>
<span class="fc" id="L771">        rect(325, targetYDisplay - barHeight + 2, healthBarfullSizeX, barHeight + 2);</span>

<span class="fc" id="L773">        fill(redRGB, greenRGB, blueRGB);</span>
<span class="fc" id="L774">        stroke(0, 0, 0);</span>
<span class="fc" id="L775">        strokeWeight(2);</span>
<span class="fc" id="L776">        rect(325, targetYDisplay - barHeight + 2, barSize, barHeight + 2);</span>

<span class="fc" id="L778">    }</span>

    /**
     * Draw the text that displays the remaining healthbar
     * 
     * @param targetYDisplay the targeted y location on screen
     */
    public void drawHealthText(int targetYDisplay) {
<span class="fc" id="L786">        int healthRounded = Math.round(tanks.get(currentPlayer).getHealth());</span>
<span class="fc" id="L787">        textFont(healthText);</span>
<span class="fc" id="L788">        fill(0);</span>
<span class="fc" id="L789">        text(healthRounded, 550, targetYDisplay);</span>
<span class="fc" id="L790">    }</span>

    /**
     * Draw the current power
     * 
     * @param healthBarfullSizeX full bar size
     * @param targetYDisplay     the targeted y location on screen
     */
    public void drawPowerBar(int healthBarfullSizeX, int targetYDisplay) {
<span class="fc" id="L799">        float power = tanks.get(currentPlayer).getPower();</span>
<span class="fc" id="L800">        int redRGB = players.get(currentPlayer).getRGBCode(&quot;red&quot;);</span>
<span class="fc" id="L801">        int greenRGB = players.get(currentPlayer).getRGBCode(&quot;green&quot;);</span>
<span class="fc" id="L802">        int blueRGB = players.get(currentPlayer).getRGBCode(&quot;blue&quot;);</span>
<span class="fc" id="L803">        float barSize = power / 100 * healthBarfullSizeX;</span>
<span class="fc" id="L804">        int barHeight = 25;</span>

<span class="fc" id="L806">        noFill();</span>
<span class="fc" id="L807">        stroke(redRGB - 50, greenRGB - 50, blueRGB - 50);</span>
<span class="fc" id="L808">        strokeWeight(8);</span>
<span class="fc" id="L809">        rect(325, targetYDisplay - barHeight + 2, barSize, barHeight + 2);</span>

<span class="fc" id="L811">        stroke(0, 0, 0);</span>
<span class="fc" id="L812">        strokeWeight(8);</span>
<span class="fc" id="L813">        line(325 + barSize, targetYDisplay - barHeight, 325 + barSize, targetYDisplay + 4);</span>
<span class="fc" id="L814">    }</span>

    /**
     * Draw the text that indicate current power
     * 
     * @param targetYDisplay the targeted y location on screen
     */
    public void drawPowerText(int targetYDisplay) {
<span class="fc" id="L822">        int power = Math.round(tanks.get(currentPlayer).getPower());</span>
<span class="fc" id="L823">        textFont(powerText);</span>
<span class="fc" id="L824">        fill(0);</span>
<span class="fc" id="L825">        text(&quot;Power: &quot; + power, 325, targetYDisplay);</span>
<span class="fc" id="L826">    }</span>

    /**
     * Draw the wind image either left or right type
     * 
     * @param targetYDisplay the targeted y location on screen
     */
    public void drawWind(int targetYDisplay) {
<span class="fc" id="L834">        int windSizeX = 60;</span>
<span class="fc" id="L835">        int windSizeY = 60;</span>
<span class="fc" id="L836">        int windSpeed = wind.getCurrentWindSpeed();</span>
<span class="fc" id="L837">        windLeft.resize(windSizeX, windSizeY);</span>
<span class="fc" id="L838">        windRight.resize(windSizeX, windSizeY);</span>

<span class="fc bfc" id="L840" title="All 2 branches covered.">        if (windSpeed &gt;= 0) {</span>
<span class="fc" id="L841">            image(windRight, 730, targetYDisplay - windSizeY / 2 - 3);</span>
        } else {
<span class="fc" id="L843">            image(windLeft, 730, targetYDisplay - windSizeY / 2 - 3);</span>
        }
<span class="fc" id="L845">    }</span>

    /**
     * Draw the text indicating wind speed
     * 
     * @param targetYDisplay the targeted y location on screen
     */
    public void drawWindText(int targetYDisplay) {
<span class="fc" id="L853">        int windSpeed = wind.getCurrentWindSpeed();</span>
<span class="fc" id="L854">        textFont(healthText);</span>
<span class="fc" id="L855">        fill(0);</span>
<span class="fc bfc" id="L856" title="All 2 branches covered.">        if (windSpeed &gt;= 0) {</span>
<span class="fc" id="L857">            text(windSpeed, 800, targetYDisplay);</span>
        } else {
<span class="fc" id="L859">            windSpeed = Math.abs(windSpeed);</span>
<span class="fc" id="L860">            text(windSpeed, 800, targetYDisplay);</span>
        }
<span class="fc" id="L862">    }</span>

    /**
     * Draw the arrow above the tank to indicate
     * the current player's turn
     */
    public void drawArrow() {
<span class="fc" id="L869">        Tank currentTank = tanks.get(currentPlayer);</span>

        // No arrow for the dead tank or tank that already shoots
<span class="fc bfc" id="L872" title="All 4 branches covered.">        if (!currentTank.isAlive() || projectileFire != 0) {</span>
<span class="fc" id="L873">            return;</span>
        }

<span class="fc" id="L876">        int xPos = currentTank.getxPos();</span>
<span class="fc" id="L877">        float yPos = currentTank.getyPos();</span>

<span class="fc bfc" id="L879" title="All 2 branches covered.">        if (arrowFrameCounter &lt;= arrowTimeSec * FPS) {</span>
<span class="fc" id="L880">            fill(0, 0, 0);</span>
<span class="fc" id="L881">            stroke(0, 0, 0);</span>
<span class="fc" id="L882">            strokeWeight(4);</span>
<span class="fc" id="L883">            line(xPos, yPos - 100, xPos, yPos - 150);</span>

<span class="fc" id="L885">            float arrowheadSize = 10; // Size of the arrowhead</span>

            // Calculate the vertices of the triangle
<span class="fc" id="L888">            float x1 = xPos - arrowheadSize / 2;</span>
<span class="fc" id="L889">            float y1 = yPos - 100;</span>
<span class="fc" id="L890">            float x2 = xPos + arrowheadSize / 2;</span>
<span class="fc" id="L891">            float y2 = yPos - 100;</span>
<span class="fc" id="L892">            float x3 = xPos;</span>
<span class="fc" id="L893">            float y3 = yPos - 100 + arrowheadSize;</span>

            // Draw the triangle
<span class="fc" id="L896">            triangle(x1, y1, x2, y2, x3, y3);</span>
<span class="fc" id="L897">            arrowFrameCounter++;</span>
        }

<span class="fc" id="L900">    }</span>

    /**
     * Draw blank space
     */
    public void drawBlank() {
<span class="fc" id="L906">        fill(255);</span>
<span class="fc" id="L907">        rect(-1, -1, WIDTH + 2, HEIGHT + 2);</span>
<span class="fc" id="L908">    }</span>

    /**
     * Draw the scoreboard
     */
    public void drawScoreBoard() {
<span class="fc" id="L914">        int scoreTextHeight = 30;</span>
<span class="fc" id="L915">        int boxHeight = 35 * players.size();</span>
<span class="fc" id="L916">        int boxWidth = 180;</span>
<span class="fc" id="L917">        int startYLoc = 100;</span>

<span class="fc" id="L919">        noFill();</span>
<span class="fc" id="L920">        stroke(0);</span>
<span class="fc" id="L921">        strokeWeight(3);</span>
<span class="fc" id="L922">        rect(WIDTH - boxWidth - 20, startYLoc, boxWidth, boxHeight);</span>

<span class="fc" id="L924">        noFill();</span>
<span class="fc" id="L925">        stroke(0);</span>
<span class="fc" id="L926">        strokeWeight(3);</span>
<span class="fc" id="L927">        rect(WIDTH - boxWidth - 20, startYLoc, boxWidth, scoreTextHeight);</span>

<span class="fc" id="L929">        text(&quot;Score&quot;, WIDTH - boxWidth - 15, startYLoc + scoreTextHeight - 5);</span>

<span class="fc" id="L931">        Map&lt;String, Float&gt; playerScores = new HashMap&lt;&gt;();</span>
<span class="fc" id="L932">        Map&lt;String, ArrayList&lt;Integer&gt;&gt; playerColors = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L933" title="All 2 branches covered.">        for (Player player : players) {</span>
<span class="fc" id="L934">            String name = player.getName();</span>
<span class="fc" id="L935">            float score = player.getTotalScore();</span>
<span class="fc" id="L936">            ArrayList&lt;Integer&gt; colorCode = player.getColorCode();</span>
<span class="fc" id="L937">            playerScores.put(name, score);</span>
<span class="fc" id="L938">            playerColors.put(name, colorCode);</span>
<span class="fc" id="L939">        }</span>

<span class="fc" id="L941">        List&lt;String&gt; nameSorted = new ArrayList&lt;&gt;(playerScores.keySet());</span>
<span class="fc" id="L942">        Collections.sort(nameSorted);</span>

<span class="fc" id="L944">        int drawCounter = 0;</span>
<span class="fc bfc" id="L945" title="All 2 branches covered.">        for (String name : nameSorted) {</span>
<span class="fc" id="L946">            int score = Math.round(playerScores.get(name));</span>
<span class="fc" id="L947">            ArrayList&lt;Integer&gt; colorCode = playerColors.get(name);</span>
<span class="fc" id="L948">            int positionY = startYLoc + scoreTextHeight * 2 + drawCounter * 25 - 5;</span>

<span class="pc bpc" id="L950" title="2 of 4 branches missed.">            if (colorCode != null &amp;&amp; !colorCode.isEmpty()) {</span>
<span class="fc" id="L951">                fill(colorCode.get(0), colorCode.get(1), colorCode.get(2));</span>
            } else {
<span class="nc" id="L953">                fill(255);</span>
            }
<span class="fc" id="L955">            text(&quot;Player &quot; + name, WIDTH - boxWidth - 10, positionY);</span>
<span class="fc" id="L956">            fill(0);</span>
<span class="fc" id="L957">            text(score, WIDTH - boxWidth + 100, positionY);</span>
<span class="fc" id="L958">            drawCounter++;</span>
<span class="fc" id="L959">        }</span>

<span class="fc" id="L961">    }</span>

    /**
     * Draw the final score for all players in order of score
     */
    public void drawEndGame() {

<span class="fc" id="L968">        drawBlank();</span>

<span class="fc" id="L970">        PFont winnerText = createFont(defaultFont, 70);</span>
<span class="fc" id="L971">        textFont(winnerText);</span>

<span class="fc" id="L973">        Map&lt;Player, Float&gt; playerScores = new HashMap&lt;&gt;();</span>
<span class="fc" id="L974">        String winner = null;</span>
<span class="fc" id="L975">        int redRGB = 0, greenRGB = 0, blueRGB = 0;</span>
<span class="fc" id="L976">        float highestScore = 0;</span>

<span class="fc bfc" id="L978" title="All 2 branches covered.">        for (Player player : players) {</span>
<span class="fc" id="L979">            float score = player.getTotalScore();</span>
<span class="fc" id="L980">            String name = player.getName();</span>
<span class="fc" id="L981">            playerScores.put(player, score);</span>

<span class="fc bfc" id="L983" title="All 2 branches covered.">            if (score &gt; highestScore) {</span>
<span class="fc" id="L984">                redRGB = player.getRGBCode(&quot;red&quot;);</span>
<span class="fc" id="L985">                greenRGB = player.getRGBCode(&quot;green&quot;);</span>
<span class="fc" id="L986">                blueRGB = player.getRGBCode(&quot;blue&quot;);</span>
<span class="fc" id="L987">                winner = name;</span>
<span class="fc" id="L988">                highestScore = score; // Update highestScore</span>
            }
<span class="fc" id="L990">        }</span>

        // draw and fill the box with winner's color
<span class="fc" id="L993">        fill(redRGB, greenRGB, blueRGB, 50);</span>
<span class="fc" id="L994">        stroke(0, 0, 0);</span>
<span class="fc" id="L995">        strokeWeight(10);</span>
<span class="fc" id="L996">        rect(100, 100, WIDTH - 200, HEIGHT - 200);</span>

<span class="fc" id="L998">        List&lt;Map.Entry&lt;Player, Float&gt;&gt; entries = new ArrayList&lt;&gt;(playerScores.entrySet());</span>

        // Sort by score from high to low
<span class="fc" id="L1001">        entries.sort(Map.Entry.comparingByValue(Comparator.reverseOrder()));</span>

        // Loop to print text by color
<span class="fc bfc" id="L1004" title="All 2 branches covered.">        for (Map.Entry&lt;Player, Float&gt; entry : entries) {</span>
<span class="fc" id="L1005">            String playerName = entry.getKey().getName();</span>
<span class="fc" id="L1006">            float playerScore = entry.getValue();</span>
<span class="fc" id="L1007">            redRGB = entry.getKey().getRGBCode(&quot;red&quot;);</span>
<span class="fc" id="L1008">            greenRGB = entry.getKey().getRGBCode(&quot;green&quot;);</span>
<span class="fc" id="L1009">            blueRGB = entry.getKey().getRGBCode(&quot;blue&quot;);</span>

<span class="fc" id="L1011">            int roundedScore = Math.round(playerScore);</span>
<span class="fc" id="L1012">            String displayText = &quot;Player &quot; + playerName + &quot;: &quot; + roundedScore;</span>

<span class="fc bfc" id="L1014" title="All 2 branches covered.">            if (playerName.equals(winner)) {</span>
<span class="fc" id="L1015">                displayText += &quot; Win!&quot;;</span>
            }

<span class="fc bfc" id="L1018" title="All 2 branches covered.">            if (endGameFrame &gt;= entries.indexOf(entry) * (0.7 * FPS)) {</span>
<span class="fc" id="L1019">                fill(redRGB, greenRGB, blueRGB);</span>
<span class="fc" id="L1020">                stroke(0, 0, 0);</span>
<span class="fc" id="L1021">                strokeWeight(3);</span>
<span class="fc" id="L1022">                text(displayText, 150, 200 + 100 * entries.indexOf(entry));</span>
            }
<span class="fc" id="L1024">        }</span>

<span class="fc" id="L1026">        endGameFrame++;</span>
<span class="fc" id="L1027">    }</span>

    /**
     * Handle the changing of player's turn,
     * and reset necessary variables
     */
    private void nextTurn() {
<span class="fc" id="L1034">        int startingPlayer = currentPlayer;</span>
        do {
<span class="fc" id="L1036">            currentPlayer++;</span>
<span class="fc" id="L1037">            currentPlayer %= tanks.size();</span>
<span class="pc bpc" id="L1038" title="3 of 4 branches missed.">        } while (!tanks.get(currentPlayer).isAlive() &amp;&amp; currentPlayer != startingPlayer); // Skip over dead players</span>

<span class="fc" id="L1040">        wind.windChange();</span>
<span class="fc" id="L1041">        arrowFrameCounter = 0;</span>
<span class="fc" id="L1042">        projectileFire = 0;</span>
<span class="fc" id="L1043">        turnPlayed++;</span>

<span class="fc" id="L1045">    }</span>

    /**
     * Handle next round sequences
     */
    private void nextRound() {
<span class="nc bnc" id="L1051" title="All 2 branches missed.">        if (!nextRoundTriggered) {</span>
<span class="nc" id="L1052">            gameCount++;</span>
<span class="nc" id="L1053">            nextRoundTriggered = true;</span>
        }

<span class="nc bnc" id="L1056" title="All 2 branches missed.">        if (hasRoundWinnerFrame &gt;= FPS) {</span>
<span class="nc bnc" id="L1057" title="All 2 branches missed.">            if (gameCount &lt; gameTotal) {</span>
<span class="nc" id="L1058">                prepareObject();</span>
            } else {
<span class="nc" id="L1060">                endGame = true;</span>
            }
        }
<span class="nc" id="L1063">    }</span>

    /**
     * Check if there is a winner in that round
     * 
     * @return if there is a winner or not
     */
    private boolean hasRoundWinner() {
<span class="fc" id="L1071">        int aliveCount = 0;</span>

<span class="fc bfc" id="L1073" title="All 2 branches covered.">        for (Tank tank : tanks) {</span>
<span class="fc bfc" id="L1074" title="All 2 branches covered.">            if (tank.isAlive()) {</span>
<span class="fc" id="L1075">                aliveCount++;</span>
            }
<span class="fc" id="L1077">        }</span>

        // cover the case for tank left=1, and when all is dead
<span class="pc bpc" id="L1080" title="2 of 4 branches missed.">        if (aliveCount == 1 || aliveCount == 0) {</span>
<span class="nc" id="L1081">            return true;</span>
        } else {
<span class="fc" id="L1083">            return false;</span>
        }
    }

    /**
     * Create the correct player playing sequence
     */
    public void processCorrectTurn() {
<span class="fc" id="L1091">        sortedTanks = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L1092">        sortedPlayers = new ArrayList&lt;&gt;();</span>

        // Iterate over the rank ArrayList
<span class="fc bfc" id="L1095" title="All 2 branches covered.">        for (String playerRank : rank) {</span>
            // Find the tank with the corresponding rank
<span class="fc bfc" id="L1097" title="All 2 branches covered.">            for (Tank tank : tanks) {</span>
<span class="fc bfc" id="L1098" title="All 2 branches covered.">                if (playerRank.equals(tank.getTankName())) {</span>
<span class="fc" id="L1099">                    sortedTanks.add(tank);</span>
<span class="fc" id="L1100">                    break;</span>
                }
<span class="fc" id="L1102">            }</span>

            // Find the player with the corresponding rank
<span class="fc bfc" id="L1105" title="All 2 branches covered.">            for (Player player : players) {</span>
<span class="fc bfc" id="L1106" title="All 2 branches covered.">                if (playerRank.equals(player.getName())) {</span>
<span class="fc" id="L1107">                    sortedPlayers.add(player);</span>
<span class="fc" id="L1108">                    break;</span>
                }
<span class="fc" id="L1110">            }</span>
<span class="fc" id="L1111">        }</span>

        // Replace the existing tanks and players ArrayLists with the sorted ones
<span class="fc" id="L1114">        tanks = sortedTanks;</span>
<span class="fc" id="L1115">        players = sortedPlayers;</span>
<span class="fc" id="L1116">    }</span>

    /**
     * Create font for all the texts
     */
    public void createFont() {
        // explicitly shown for each text to easily change aesthetic if required
<span class="fc" id="L1123">        playerTurnText = createFont(defaultFont, defaultFontSize);</span>
<span class="fc" id="L1124">        fuelText = createFont(defaultFont, defaultFontSize);</span>
<span class="fc" id="L1125">        healthText = createFont(defaultFont, defaultFontSize);</span>
<span class="fc" id="L1126">        powerText = createFont(defaultFont, defaultFontSize);</span>
<span class="fc" id="L1127">        windText = createFont(defaultFont, defaultFontSize);</span>
<span class="fc" id="L1128">        parachuteText = createFont(defaultFont, defaultFontSize);</span>
<span class="fc" id="L1129">        playerScoreText = createFont(defaultFont, defaultSmallFontSize);</span>
<span class="fc" id="L1130">    }</span>

    /**
     * Get the FPS
     * 
     * @return FPS
     */
    public static int getFPS() {
<span class="fc" id="L1138">        return FPS;</span>
    }

    /**
     * Get display info
     * 
     * @param side width or height
     * @return width or height or 0
     */
    public static int getBoard(String side) {
<span class="fc bfc" id="L1148" title="All 2 branches covered.">        if (side.equals(&quot;width&quot;)) {</span>
<span class="fc" id="L1149">            return WIDTH;</span>
<span class="fc bfc" id="L1150" title="All 2 branches covered.">        } else if (side.equals(&quot;height&quot;)) {</span>
<span class="fc" id="L1151">            return HEIGHT;</span>
        } else {
<span class="fc" id="L1153">            return 0;</span>
        }
    }

    /**
     * Get the cell information
     * 
     * @param side width or height
     * @return cellwidth or cellheight
     */
    public static int getCell(String side) {
<span class="fc bfc" id="L1164" title="All 2 branches covered.">        if (side.equals(&quot;width&quot;)) {</span>
<span class="fc" id="L1165">            return CELLWIDTH;</span>
<span class="fc bfc" id="L1166" title="All 2 branches covered.">        } else if (side.equals(&quot;height&quot;)) {</span>
<span class="fc" id="L1167">            return CELLHEIGHT;</span>
        } else {
<span class="fc" id="L1169">            return 0;</span>
        }
    }

    /**
     * Get the terrain array size
     * 
     * @return terrain array size
     */
    public int getTerrainArraySize() {
<span class="fc" id="L1179">        return smoothTerrain.size();</span>
    }

    /**
     * Set terrain height
     * 
     * @param x      x position
     * @param height desired height
     */
    public static void setTerrainHeight(int x, float height) {
<span class="pc bpc" id="L1189" title="1 of 4 branches missed.">        if (x &lt; 0 || x &gt; WIDTH) {</span>
<span class="fc" id="L1190">            return;</span>
        }
<span class="fc" id="L1192">        smoothTerrain.set(x, height);</span>
<span class="fc" id="L1193">    }</span>

    /**
     * Get the terrain height at specific x position
     * 
     * @param x    x position
     * @param type pixel or raw type
     * @return height in pixel
     */
    public static float getTerrainHeight(int x, String type) {
<span class="pc bpc" id="L1203" title="1 of 4 branches missed.">        if (x &lt; 0 || x &gt; WIDTH) {</span>
<span class="fc" id="L1204">            return 0;</span>
        }

<span class="fc bfc" id="L1207" title="All 2 branches covered.">        if (type.equals(&quot;pixel&quot;)) {</span>
<span class="fc" id="L1208">            return smoothTerrain.get(x) * CELLHEIGHT;</span>
        } else {
<span class="fc" id="L1210">            return smoothTerrain.get(x);</span>
        }
    }

    /**
     * Get the current game count
     * 
     * @return game count
     */
    public static int getGameCount() {
<span class="fc" id="L1220">        return gameCount;</span>
    }

    /**
     * Get tree file path
     * 
     * @return tree file path
     */
    public static String getTreeFilePath() {
<span class="fc" id="L1229">        return treeFilePath;</span>
    }

    /**
     * Grant score to player
     * 
     * @param damage   damage dealed
     * @param receiver the player who receives score
     */
    public void grantScore(Float damage, String receiver) {
<span class="fc bfc" id="L1239" title="All 2 branches covered.">        for (Player player : players) {</span>
<span class="fc" id="L1240">            String playerName = player.getName();</span>
<span class="fc bfc" id="L1241" title="All 2 branches covered.">            if (playerName.equals(receiver)) {</span>
<span class="fc" id="L1242">                player.updateRoundScore(damage);</span>
<span class="fc" id="L1243">                player.updateTotalScore(damage);</span>
            }
<span class="fc" id="L1245">        }</span>
<span class="fc" id="L1246">    }</span>

    /**
     * Set the end game
     */
    public void setEndGame() {
<span class="fc" id="L1252">        endGame = true;</span>
<span class="fc" id="L1253">    }</span>

    /**
     * Restart game sequences
     */
    public void restartGame() {
<span class="fc" id="L1259">        endGame = false;</span>
<span class="fc" id="L1260">        gameCount = 0;</span>
<span class="fc" id="L1261">        endGameFrame = 0;</span>
<span class="fc" id="L1262">        smoothTerrain.clear();</span>
<span class="fc" id="L1263">        projectiles.clear();</span>
<span class="fc" id="L1264">        explosions.clear();</span>
<span class="fc" id="L1265">        levels.clear();</span>
<span class="fc" id="L1266">        colors.clear();</span>
<span class="fc" id="L1267">        players.clear();</span>
<span class="fc" id="L1268">        tanks.clear();</span>
<span class="fc" id="L1269">        trees.clear();</span>

<span class="fc" id="L1271">        setup();</span>
<span class="fc" id="L1272">    }</span>

    /**
     * Get projectile array
     * 
     * @return projectile array
     */
    public ArrayList&lt;Projectile&gt; getProjectiles() {
<span class="fc" id="L1280">        return projectiles;</span>
    }

    /**
     * Add explosion to explosion array
     * 
     * @param explosion explosion object
     */
    public void addExplosion(Explosion explosion) {
<span class="fc" id="L1289">        explosions.add(explosion);</span>
<span class="fc" id="L1290">    }</span>

    /**
     * Add projectile to projectile array
     * 
     * @param projectile projectile object
     */
    public void addProjectile(Projectile projectile) {
<span class="fc" id="L1298">        projectiles.add(projectile);</span>
<span class="fc" id="L1299">    }</span>

    /**
     * Add tank to tank array
     * 
     * @param tank tank object
     */
    public void addTank(Tank tank) {
<span class="fc" id="L1307">        tanks.add(tank);</span>
<span class="fc" id="L1308">    }</span>

    /**
     * Get tank array
     * 
     * @return tank array
     */
    public ArrayList&lt;Tank&gt; getTanks() {
<span class="fc" id="L1316">        return tanks;</span>
    }

    /**
     * Get color array
     * 
     * @return color array
     */
    public ArrayList&lt;Color&gt; getColors() {
<span class="fc" id="L1325">        return colors;</span>
    }

    /**
     * Get wind object
     * 
     * @return wind object
     */
    public Wind getWind() {
<span class="fc" id="L1334">        return wind;</span>
    }

    /**
     * Get current player object
     * 
     * @return current player object
     */
    public static Player getCurrentPlayer() {
<span class="fc" id="L1343">        return players.get(currentPlayer);</span>
    }

    /**
     * Set the round winner frame counter
     * 
     * @param frame frame counter
     */
    public void setRoundWinnerFrame(int frame) {
<span class="fc" id="L1352">        hasRoundWinnerFrame = frame;</span>
<span class="fc" id="L1353">    }</span>

    /**
     * Set trigger of the next round sequence
     */
    public void setNextRoundTriggered() {
<span class="fc" id="L1359">        nextRoundTriggered = true;</span>
<span class="fc" id="L1360">    }</span>

    /**
     * Get player array
     * 
     * @return player array
     */
    public ArrayList&lt;Player&gt; getPlayers() {
<span class="fc" id="L1368">        return players;</span>
    }

    /**
     * Set game count
     * 
     * @param count game count
     */
    public static void setGameCount(int count) {
<span class="fc" id="L1377">        gameCount = count;</span>
<span class="fc" id="L1378">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>